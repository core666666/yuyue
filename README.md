# 鱼阅 - 碎片化时间的沉浸式阅读器

> 在忙里偷闲的三分钟，也能沉浸在三页小说里。

## 项目简介

鱼阅是一款专为现代职场人士设计的低打扰桌面阅读器，让你在工作间隙快速进入小说世界，又能随时无痕切换回工作界面。支持快捷键秒开、窗口伪装、进度自动同步与离线章节缓存等特色功能。

## 技术栈

- **框架**: .NET 8 + WPF
- **发布方式**: 自包含发布（Self-Contained）
- **目标平台**: Windows 10/11
- **架构**: MVVM（WPF）

## 核心功能需求

### 1. 快速启动与切换

#### 1.1 全局热键系统
- 支持自定义全局热键（默认 `Ctrl+Shift+F`）唤醒阅读器
- 注册系统级热键，任意程序下都能响应
- 热键冲突检测与提示
- 支持热键自定义配置

#### 1.2 老板键功能
- 一键隐藏窗口（默认 `Esc` 或 `Alt+H`）
- 支持三种隐藏模式：
  - 最小化到托盘
  - 完全隐藏窗口（进程仍运行）
  - 伪装成工作界面（见下文）
- 记忆上次隐藏模式

#### 1.3 托盘集成
- 最小化到系统托盘，不占用任务栏
- 托盘图标菜单：
  - 快速打开/隐藏
  - 最近阅读
  - 设置
  - 退出
- 双击托盘图标恢复窗口
- 托盘消息通知（章节更新、同步完成等）

#### 1.4 启动优化
- 开机自启动选项（默认关闭）
- 后台驻留模式（启动后隐藏在托盘）
- 快速启动（< 1秒冷启动时间）
- 断点恢复（记忆上次阅读位置和窗口状态）

### 2. 窗口伪装模式

#### 2.1 伪装界面
- **代码编辑器模式**: 模拟 VS Code 界面，显示假代码
- **Excel 表格模式**: 显示财务报表或数据表格
- **Word 文档模式**: 显示工作文档模板
- **浏览器模式**: 模拟浏览器显示工作相关网页
- 支持自定义伪装界面（用户可导入图片或网页截图）

#### 2.2 窗口行为
- 透明度调节（10%-100%）
- 窗口置顶选项
- 无边框模式
- 自适应窗口大小（记忆用户设置）
- 多显示器支持

#### 2.3 快速切换
- 快捷键在阅读模式和伪装模式间切换（默认 `F12`）
- 切换时保持阅读进度
- 平滑过渡动画（可选）

### 3. 阅读体验优化

#### 3.1 界面设计
- **极简模式**: 纯文本，去除所有干扰元素
- **沉浸模式**: 全屏阅读，自动隐藏标题栏和工具栏
- **分栏阅读**: 支持单栏、双栏、三栏布局
- **护眼模式**: 内置多种护眼配色方案
  - 浅色主题（白底黑字）
  - 深色主题（黑底白字）
  - 纸质书主题（米黄色底）
  - 护眼绿主题
  - 自定义主题（用户可调配色、背景图）

#### 3.2 字体与排版
- 字体自定义（支持系统字体）
- 字号调节（10-48px，快捷键 `Ctrl +/-`）
- 行间距调节（1.0-3.0倍）
- 段落间距调节
- 对齐方式（左对齐、两端对齐）
- 首行缩进设置

#### 3.3 翻页与导航
- 翻页方式：
  - 键盘方向键
  - 鼠标滚轮
  - 空格键翻页
  - 点击屏幕左右区域
  - 自定义快捷键
- 自动翻页功能（定时器，可调速度）
- 进度条实时显示
- 章节快速跳转
- 书签系统（支持多个书签）

#### 3.4 专注计时功能
- 阅读计时器（累计本次阅读时长）
- 每日阅读统计（时长、章节数、字数）
- 阅读历史记录（日历视图）
- 阅读目标设置（每日目标时长/字数）
- 番茄钟集成（25分钟专注，5分钟休息）
- 阅读统计报表（周报、月报）

### 4. 内容管理

#### 4.1 书源系统
- 支持多书源配置
- 内置主流小说网站书源
- 自定义书源（支持规则编辑器）
- 书源管理（启用/禁用、优先级、更新）
- 书源测试与验证
- 备用书源自动切换

#### 4.2 小说搜索与下载
- 全网搜索（跨书源搜索）
- 搜索结果排序（更新时间、热度、字数）
- 小说详情预览（简介、标签、评分、字数）
- 加入书架
- 批量下载章节
- 后台自动检查更新

#### 4.3 离线缓存
- 智能预缓存（自动缓存当前章节±5章）
- 全本缓存（一键缓存全书）
- 缓存管理器：
  - 查看缓存大小
  - 清理缓存
  - 缓存路径设置
- 离线模式（无网络时自动切换）
- 缓存优先级（优先缓存收藏的书）

#### 4.4 书架管理
- 书架分组（正在读、已读完、想读）
- 自定义分类（标签系统）
- 书籍排序（最近阅读、更新时间、添加时间）
- 批量操作（删除、移动、缓存）
- 书籍搜索与筛选
- 书籍卡片视图/列表视图

### 5. 进度同步

#### 5.1 本地同步
- SQLite 数据库存储阅读进度
- 自动保存阅读位置（实时/每N秒）
- 多设备数据导出/导入（JSON格式）
- 数据备份与恢复

#### 5.2 云同步（可选功能）
- 支持 WebDAV 同步
- 支持自定义服务器同步
- 增量同步（只同步变更数据）
- 冲突解决策略（以最新为准/手动选择）
- 同步状态提示
- 自动同步/手动同步切换

#### 5.3 阅读历史
- 阅读时间轴（按时间查看阅读记录）
- 快速回溯到某个历史位置
- 历史记录搜索
- 清理历史记录

### 6. 高级功能

#### 6.1 文本处理
- 简繁体转换
- 敏感词过滤（自定义词库）
- 错别字修正（基于规则库）
- 段落重新排版（去除多余空行、统一格式）
- TTS 朗读（调用系统语音或第三方引擎）

#### 6.2 批注与笔记
- 划线标记（高亮、下划线、波浪线）
- 添加批注（点击高亮文本添加笔记）
- 批注管理器（查看所有批注）
- 导出批注（Markdown/TXT格式）

#### 6.3 导入与导出
- 支持导入格式：
  - TXT
  - EPUB
  - MOBI（需转换）
  - PDF（文本提取）
- 支持导出格式：
  - TXT
  - EPUB
  - PDF
- 本地文件管理（扫描本地书籍文件夹）

#### 6.4 RSS订阅（可选）
- 订阅作者更新RSS
- 新章节桌面通知
- RSS源管理

### 7. 系统设置

#### 7.1 通用设置
- 语言选择（中文、英文）
- 自动更新检查
- 启动设置（开机启动、启动后隐藏）
- 性能设置（动画效果、硬件加速）

#### 7.2 快捷键设置
- 全局热键自定义
- 应用内快捷键自定义
- 快捷键冲突检测
- 重置为默认快捷键

#### 7.3 外观设置
- 主题选择
- 自定义配色
- 字体设置
- 窗口透明度
- 动画效果开关

#### 7.4 网络设置
- 代理设置（HTTP/SOCKS5）
- 超时时间设置
- 并发下载数限制
- 下载速度限制

#### 7.5 隐私与安全
- 清除阅读历史
- 清除缓存
- 主密码保护（启动需要密码）
- 无痕模式（不记录阅读历史）

### 8. 性能与优化

#### 8.1 资源占用
- 内存占用 < 150MB（空闲时）
- CPU占用 < 5%（阅读时）
- 磁盘占用可控（缓存大小限制）

#### 8.2 启动速度
- 冷启动 < 1秒
- 热键唤醒 < 0.3秒

#### 8.3 稳定性
- 异常捕获与日志记录
- 崩溃自动恢复
- 数据定期备份

## 技术实现要点

### WPF vs WinForms 选择建议

**推荐使用 WPF**，原因：
- 更好的界面美化和动画效果支持
- MVVM架构更适合复杂功能
- 数据绑定更强大
- 更现代的UI设计
- 支持矢量图标（不失真）

### 核心技术模块

1. **全局热键**: Windows API (`RegisterHotKey`)
2. **窗口伪装**: 动态加载界面模板，窗口样式切换
3. **托盘图标**: `NotifyIcon` 控件
4. **数据存储**: SQLite（Entity Framework Core）
5. **网络请求**: `HttpClient` + HTML解析（AngleSharp/HtmlAgilityPack）
6. **文本渲染**: WPF `RichTextBox` 或自定义控件
7. **文件处理**: EPUB（VersOne.Epub）、PDF（iTextSharp/PdfSharp）
8. **同步功能**: WebDAV客户端库
9. **自动更新**: Squirrel.Windows 或自实现

### 项目结构建议

```
YuYue/
├── YuYue.Core/              # 核心业务逻辑
│   ├── Models/              # 数据模型
│   ├── Services/            # 服务层（书源、下载、同步）
│   ├── Repositories/        # 数据访问层
│   └── Utilities/           # 工具类
├── YuYue.UI/                # WPF界面层
│   ├── Views/               # 视图
│   ├── ViewModels/          # 视图模型
│   ├── Controls/            # 自定义控件
│   ├── Themes/              # 主题资源
│   └── Converters/          # 数据转换器
├── YuYue.Parser/            # 书源解析模块
│   ├── Interfaces/          # 解析器接口
│   └── Parsers/             # 各书源解析器实现
├── YuYue.Storage/           # 存储模块
│   ├── Database/            # 数据库上下文
│   └── Cache/               # 缓存管理
└── YuYue.Tests/             # 单元测试
```

## 开发路线图

### Phase 1: MVP（最小可行产品）✅
- [x] 基础窗口框架与界面
- [x] 本地TXT文件导入与阅读
- [x] 阅读进度保存（本地）
- [x] 基础快捷键（翻页、退出）
- [x] 简单的书架管理

### Phase 2: 核心功能 ✅
- [x] 全局热键与老板键
- [x] 托盘集成
- [ ] 多书源搜索与下载
- [ ] 离线缓存系统
- [x] 阅读界面优化（主题、字体）

### Phase 3: 增强功能 ✅
- [x] 窗口伪装模式
- [x] 专注计时功能
- [ ] 云同步（WebDAV）
- [ ] TTS朗读
- [ ] 批注与笔记

### Phase 4: 高级功能 🚧
- [ ] EPUB/PDF支持
- [ ] 自定义书源编辑器
- [x] 阅读统计分析
- [ ] RSS订阅
- [ ] 插件系统

## 🎉 v2.0 重大更新

### 新增高级阅读功能
- ✅ **极简/沉浸模式**: 一键进入专注阅读状态
- ✅ **多栏排版**: 支持1-3栏灵活布局
- ✅ **8种护眼主题**: 日间、夜间、护眼绿、羊皮纸等
- ✅ **细化排版设置**: 字体、行距、段距、首行缩进
- ✅ **自动翻页**: 定时自动翻页，解放双手
- ✅ **智能章节识别**: 自动识别章节并快速跳转
- ✅ **书签系统**: 标记精彩片段，随时回顾
- ✅ **专注计时**: 记录阅读时长，培养阅读习惯
- ✅ **阅读统计**: 可视化阅读数据
- ✅ **自定义主题**: 打造专属阅读环境

### 查看详细文档
- 📖 [功能说明](YuYue/ADVANCED_FEATURES.md)
- 📚 [使用指南](YuYue/USAGE_GUIDE.md)
- 🚀 [快速参考](YuYue/QUICK_REFERENCE.md)
- 📋 [更新日志](YuYue/RELEASE_NOTES_v2.0.md)

## 许可证

待定（建议使用 MIT 或 GPL-3.0）

## 贡献指南

欢迎贡献代码、书源规则、主题配色等！

## 联系方式

待补充

---

**注**: 这是一个功能需求文档，具体实现细节需要在开发过程中逐步完善。