# 鱼阅 v2.0 - 碎片化时间的沉浸式阅读器

> 在忙里偷闲的三分钟，也能沉浸在三页小说里。

## 🚀 快速开始

### 运行应用
```powershell
dotnet run --project YuYue/YuYue.csproj
```

### 第一次使用
1. 点击"导入本地小说"
2. 选择TXT文件
3. 双击打开书籍
4. 开始阅读！

## 项目简介

鱼阅是一款专为现代职场人士设计的低打扰桌面阅读器，让你在工作间隙快速进入小说世界，又能随时无痕切换回工作界面。支持快捷键秒开、窗口伪装、进度自动同步与离线章节缓存等特色功能。

## 技术栈

- **框架**: .NET 8 + WPF
- **发布方式**: 自包含发布（Self-Contained）
- **目标平台**: Windows 10/11
- **架构**: MVVM（WPF）
- **依赖**: CommunityToolkit.Mvvm, Entity Framework Core, SQLite

## 核心功能需求

### 1. 快速启动与切换

#### 1.1 全局热键系统
- 支持自定义全局热键（默认 `Ctrl+Shift+F`）唤醒阅读器
- 注册系统级热键，任意程序下都能响应
- 热键冲突检测与提示
- 支持热键自定义配置

#### 1.2 老板键功能
- 一键隐藏窗口（默认 `Esc` 或 `Alt+H`）
- 支持三种隐藏模式：
  - 最小化到托盘
  - 完全隐藏窗口（进程仍运行）
  - 伪装成工作界面（见下文）
- 记忆上次隐藏模式

#### 1.3 托盘集成
- 最小化到系统托盘，不占用任务栏
- 托盘图标菜单：
  - 快速打开/隐藏
  - 最近阅读
  - 设置
  - 退出
- 双击托盘图标恢复窗口
- 托盘消息通知（章节更新、同步完成等）

#### 1.4 启动优化
- 开机自启动选项（默认关闭）
- 后台驻留模式（启动后隐藏在托盘）
- 快速启动（< 1秒冷启动时间）
- 断点恢复（记忆上次阅读位置和窗口状态）

### 2. 窗口伪装模式

#### 2.1 伪装界面
- **代码编辑器模式**: 模拟 VS Code 界面，显示假代码
- **Excel 表格模式**: 显示财务报表或数据表格
- **Word 文档模式**: 显示工作文档模板
- **浏览器模式**: 模拟浏览器显示工作相关网页
- 支持自定义伪装界面（用户可导入图片或网页截图）

#### 2.2 窗口行为
- 透明度调节（10%-100%）
- 窗口置顶选项
- 无边框模式
- 自适应窗口大小（记忆用户设置）
- 多显示器支持

#### 2.3 快速切换 ✅
- 快捷键在阅读模式和伪装模式间切换（默认 `F12`）
- 切换时保持阅读进度
- 伪装模式独立窗口显示，主窗口自动最小化
- 关闭伪装窗口自动恢复主窗口

### 3. 阅读体验优化

#### 3.1 界面设计
- **极简模式**: 纯文本，去除所有干扰元素
- **沉浸模式**: 全屏阅读，自动隐藏标题栏和工具栏
- **分栏阅读**: 支持单栏、双栏、三栏布局
- **护眼模式**: 内置多种护眼配色方案
  - 浅色主题（白底黑字）
  - 深色主题（黑底白字）
  - 纸质书主题（米黄色底）
  - 护眼绿主题
  - 自定义主题（用户可调配色、背景图）

#### 3.2 字体与排版
- 字体自定义（支持系统字体）
- 字号调节（10-48px，快捷键 `Ctrl +/-`）
- 行间距调节（1.0-3.0倍）
- 段落间距调节
- 对齐方式（左对齐、两端对齐）
- 首行缩进设置

#### 3.3 翻页与导航
- 翻页方式：
  - 键盘方向键
  - 鼠标滚轮
  - 空格键翻页
  - 点击屏幕左右区域
  - 自定义快捷键
- 自动翻页功能（定时器，可调速度）
- 进度条实时显示
- 章节快速跳转
- 书签系统（支持多个书签）

#### 3.4 专注计时功能
- 阅读计时器（累计本次阅读时长）
- 每日阅读统计（时长、章节数、字数）
- 阅读历史记录（日历视图）
- 阅读目标设置（每日目标时长/字数）
- 番茄钟集成（25分钟专注，5分钟休息）
- 阅读统计报表（周报、月报）

### 4. 内容管理

#### 4.1 书源系统
- 支持多书源配置
- 内置主流小说网站书源
- 自定义书源（支持规则编辑器）
- 书源管理（启用/禁用、优先级、更新）
- 书源测试与验证
- 备用书源自动切换

#### 4.2 小说搜索与下载
- 全网搜索（跨书源搜索）
- 搜索结果排序（更新时间、热度、字数）
- 小说详情预览（简介、标签、评分、字数）
- 加入书架
- 批量下载章节
- 后台自动检查更新

#### 4.3 离线缓存
- 智能预缓存（自动缓存当前章节±5章）
- 全本缓存（一键缓存全书）
- 缓存管理器：
  - 查看缓存大小
  - 清理缓存
  - 缓存路径设置
- 离线模式（无网络时自动切换）
- 缓存优先级（优先缓存收藏的书）

#### 4.4 书架管理
- 书架分组（正在读、已读完、想读）
- 自定义分类（标签系统）
- 书籍排序（最近阅读、更新时间、添加时间）
- 批量操作（删除、移动、缓存）
- 书籍搜索与筛选
- 书籍卡片视图/列表视图

### 5. 进度同步

#### 5.1 本地同步
- SQLite 数据库存储阅读进度
- 自动保存阅读位置（实时/每N秒）
- 多设备数据导出/导入（JSON格式）
- 数据备份与恢复

#### 5.2 云同步（可选功能）
- 支持 WebDAV 同步
- 支持自定义服务器同步
- 增量同步（只同步变更数据）
- 冲突解决策略（以最新为准/手动选择）
- 同步状态提示
- 自动同步/手动同步切换

#### 5.3 阅读历史
- 阅读时间轴（按时间查看阅读记录）
- 快速回溯到某个历史位置
- 历史记录搜索
- 清理历史记录

### 6. 高级功能

#### 6.1 文本处理
- 简繁体转换
- 敏感词过滤（自定义词库）
- 错别字修正（基于规则库）
- 段落重新排版（去除多余空行、统一格式）
- TTS 朗读（调用系统语音或第三方引擎）

#### 6.2 批注与笔记
- 划线标记（高亮、下划线、波浪线）
- 添加批注（点击高亮文本添加笔记）
- 批注管理器（查看所有批注）
- 导出批注（Markdown/TXT格式）

#### 6.3 导入与导出
- 支持导入格式：
  - TXT
  - EPUB
  - MOBI（需转换）
  - PDF（文本提取）
- 支持导出格式：
  - TXT
  - EPUB
  - PDF
- 本地文件管理（扫描本地书籍文件夹）

#### 6.4 RSS订阅（可选）
- 订阅作者更新RSS
- 新章节桌面通知
- RSS源管理

### 7. 系统设置

#### 7.1 通用设置
- 语言选择（中文、英文）
- 自动更新检查
- 启动设置（开机启动、启动后隐藏）
- 性能设置（动画效果、硬件加速）

#### 7.2 快捷键设置
- 全局热键自定义
- 应用内快捷键自定义
- 快捷键冲突检测
- 重置为默认快捷键

#### 7.3 外观设置
- 主题选择
- 自定义配色
- 字体设置
- 窗口透明度
- 动画效果开关

#### 7.4 网络设置
- 代理设置（HTTP/SOCKS5）
- 超时时间设置
- 并发下载数限制
- 下载速度限制

#### 7.5 隐私与安全
- 清除阅读历史
- 清除缓存
- 主密码保护（启动需要密码）
- 无痕模式（不记录阅读历史）

### 8. 性能与优化

#### 8.1 资源占用
- 内存占用 < 150MB（空闲时）
- CPU占用 < 5%（阅读时）
- 磁盘占用可控（缓存大小限制）

#### 8.2 启动速度
- 冷启动 < 1秒
- 热键唤醒 < 0.3秒

#### 8.3 稳定性
- 异常捕获与日志记录
- 崩溃自动恢复
- 数据定期备份

## 技术实现要点

### WPF vs WinForms 选择建议

**推荐使用 WPF**，原因：
- 更好的界面美化和动画效果支持
- MVVM架构更适合复杂功能
- 数据绑定更强大
- 更现代的UI设计
- 支持矢量图标（不失真）

### 核心技术模块

1. **全局热键**: Windows API (`RegisterHotKey`)
2. **窗口伪装**: 动态加载界面模板，窗口样式切换
3. **托盘图标**: `NotifyIcon` 控件
4. **数据存储**: SQLite（Entity Framework Core）
5. **网络请求**: `HttpClient` + HTML解析（AngleSharp/HtmlAgilityPack）
6. **文本渲染**: WPF `RichTextBox` 或自定义控件
7. **文件处理**: EPUB（VersOne.Epub）、PDF（iTextSharp/PdfSharp）
8. **同步功能**: WebDAV客户端库
9. **自动更新**: Squirrel.Windows 或自实现

### 项目结构建议

```
YuYue/
├── YuYue.Core/              # 核心业务逻辑
│   ├── Models/              # 数据模型
│   ├── Services/            # 服务层（书源、下载、同步）
│   ├── Repositories/        # 数据访问层
│   └── Utilities/           # 工具类
├── YuYue.UI/                # WPF界面层
│   ├── Views/               # 视图
│   ├── ViewModels/          # 视图模型
│   ├── Controls/            # 自定义控件
│   ├── Themes/              # 主题资源
│   └── Converters/          # 数据转换器
├── YuYue.Parser/            # 书源解析模块
│   ├── Interfaces/          # 解析器接口
│   └── Parsers/             # 各书源解析器实现
├── YuYue.Storage/           # 存储模块
│   ├── Database/            # 数据库上下文
│   └── Cache/               # 缓存管理
└── YuYue.Tests/             # 单元测试
```

## 开发路线图

### Phase 1: MVP（最小可行产品）✅
- [x] 基础窗口框架与界面
- [x] 本地TXT文件导入与阅读
- [x] 阅读进度保存（本地）
- [x] 基础快捷键（翻页、退出）
- [x] 简单的书架管理

### Phase 2: 核心功能 ✅
- [x] 全局热键与老板键
- [x] 托盘集成
- [x] 热键冲突检测与提示
- [x] 热键自定义配置界面
- [x] 开机自启动选项
- [ ] 多书源搜索与下载
- [ ] 离线缓存系统
- [x] 阅读界面优化（主题、字体）

### Phase 3: 增强功能 ✅
- [x] 窗口伪装模式（独立窗口实现）
- [x] 专注计时功能
- [ ] 云同步（WebDAV）
- [ ] TTS朗读
- [ ] 批注与笔记

### Phase 4: 高级功能 🚧
- [ ] EPUB/PDF支持
- [ ] 自定义书源编辑器
- [x] 阅读统计分析
- [ ] RSS订阅
- [ ] 插件系统

## 🎉 v2.0 重大更新

### 新增高级阅读功能
- ✅ **极简/沉浸模式**: 一键进入专注阅读状态（F11）
- ✅ **多栏排版**: 支持1-3栏灵活布局
- ✅ **8种护眼主题**: 日间、夜间、护眼绿、羊皮纸、海洋蓝、樱花粉、灰度、琥珀
- ✅ **细化排版设置**: 字体（12-36px）、行距（1.0-3.0倍）、段距（0-20px）、首行缩进
- ✅ **自动翻页**: 定时自动翻页（3-60秒可调），解放双手
- ✅ **智能章节识别**: 自动识别章节并快速跳转（支持多种格式）
- ✅ **书签系统**: 标记精彩片段，随时回顾（Ctrl+D）
- ✅ **专注计时**: 记录阅读时长，培养阅读习惯
- ✅ **阅读统计**: 可视化阅读数据（今日时长、进度、章节统计）
- ✅ **自定义主题**: 打造专属阅读环境

## ⌨️ 常用快捷键

### 全局热键（任何界面都可用）
| 功能 | 默认快捷键 | 说明 |
|------|-----------|------|
| 显示/隐藏窗口 | Ctrl+Alt+Y | 快速切换窗口显示状态 |

### 应用内快捷键
| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 伪装模式 | F12 / Ctrl+Shift+C | 快速切换伪装界面 |
| 沉浸模式 | F11 | 全屏专注阅读 |
| 添加书签 | Ctrl+D | 标记当前位置 |
| 切换主题 | Ctrl+T | 循环切换主题 |
| 上一页 | PageUp / ← | 翻到上一页 |
| 下一页 | PageDown / → | 翻到下一页 |
| 上一章 | Ctrl+↑ | 跳转到上一章 |
| 下一章 | Ctrl+↓ | 跳转到下一章 |
| 增大字体 | Ctrl++ | 字体放大 |
| 减小字体 | Ctrl+- | 字体缩小 |
| 保存进度 | Ctrl+S | 手动保存 |
| 返回书架 | Esc | 退出阅读 |

**💡 提示**：所有快捷键都可以在"设置 → 自定义快捷键"中修改！

## 🎨 主题预览

| 主题名称 | 背景色 | 文字色 | 适用场景 |
|---------|--------|--------|----------|
| 日间模式 | 浅蓝白 | 深灰 | 白天阅读 |
| 夜间模式 | 深蓝灰 | 浅灰白 | 夜间阅读 |
| 羊皮纸 | 米黄 | 棕色 | 复古风格 |
| 护眼绿 | 淡绿 | 深灰 | 长时间阅读 |
| 海洋蓝 | 浅蓝 | 深蓝 | 清新风格 |
| 樱花粉 | 淡粉 | 深紫 | 温馨风格 |
| 灰度 | 浅灰 | 深灰 | 简约风格 |
| 琥珀 | 淡黄 | 棕色 | 温暖风格 |

## 📖 支持格式

- TXT文件（UTF-8, GB18030, UTF-16, Big5）
- 自动编码检测
- 智能乱码识别

## 📚 使用指南

### 导入书籍并开始阅读

1. 点击"导入本地小说"按钮
2. 选择TXT格式的小说文件
3. 书籍自动添加到书架
4. 双击书籍或点击"阅读"按钮开始阅读

### 自定义阅读体验

#### 选择护眼主题
- 方法1: 点击工具栏的主题下拉菜单，选择喜欢的主题
- 方法2: 点击"🎨 主题"按钮快速切换
- 方法3: 按 Ctrl+T 快捷键循环切换

推荐主题：
- **白天**：日间模式、海洋蓝
- **夜晚**：夜间模式、琥珀
- **长时间**：护眼绿、羊皮纸

#### 调整字体和排版
- **字体大小**：点击 Aa+ / Aa- 按钮，或使用 Ctrl++ / Ctrl+- 快捷键
- **行距调整**：拖动底部工具栏的"行距"滑块（推荐值：1.6-2.0倍）
- **段落间距**：拖动底部工具栏的"段距"滑块（推荐值：8-12像素）
- **首行缩进**：勾选底部工具栏的"首行缩进"复选框

#### 多栏排版
根据屏幕大小选择：
- 手机/小屏：1栏
- 平板/中屏：2栏
- 电脑/大屏：2-3栏

切换方法：点击工具栏的"1栏"、"2栏"、"3栏"按钮

### 章节导航

#### 查看章节列表
1. 点击工具栏"📖 章节"按钮
2. 侧边栏显示所有章节
3. 点击章节标题快速跳转

#### 章节间跳转
- 上一章：Ctrl+Up 或点击"上一章"按钮
- 下一章：Ctrl+Down 或点击"下一章"按钮

#### 章节识别说明
系统自动识别以下格式：
- 第一章 标题
- 第1节 标题
- Chapter 1 标题
- 1. 标题
- 【第一章】标题

### 书签管理

#### 添加书签
- 方法1: 点击"🔖 书签"面板的"+"按钮
- 方法2: 按 Ctrl+D 快捷键

#### 使用书签
1. 点击工具栏"🔖 书签"按钮打开书签列表
2. 点击书签名称跳转到对应位置
3. 点击书签右侧"×"按钮删除书签

#### 书签技巧
- 在重要情节处添加书签
- 给书签起有意义的名称
- 定期清理不需要的书签
- 每本书建议保持5-10个书签

### 伪装模式（老板键）

#### 快速切换
- **进入伪装模式**：按 F12 键
  - 主窗口自动最小化
  - 弹出伪装窗口（模拟工作界面）
- **退出伪装模式**：再次按 F12 或 Esc 键
  - 伪装窗口关闭
  - 主窗口自动恢复

#### 伪装界面类型
1. **代码编辑器**：模拟 VS Code 界面，显示 C# 代码
2. **Excel 表格**：显示销售数据分析表
3. **浏览器**：显示技术文档页面

#### 切换伪装类型
- 在伪装窗口中按 Ctrl+Tab 切换不同伪装界面
- 顶部提示栏显示当前伪装类型

#### 使用场景
- 办公室阅读，需要快速切换到工作界面
- 公共场所阅读，保护隐私
- 多任务处理，快速在阅读和工作间切换

### 专注阅读

#### 沉浸模式
- 进入沉浸模式：点击工具栏"🎯 沉浸"按钮或按 F11 键
- 退出沉浸模式：再次点击按钮或按 F11，或按 Esc 键

#### 阅读计时
- 计时器自动启动：打开书籍时自动开始计时
- 工具栏显示实时阅读时长
- 手动控制：点击"⏱️ 计时"按钮暂停/继续，或按 Ctrl+P 快捷键
- 查看统计：点击"📊 统计"查看详细数据

#### 自动翻页
- 开启自动翻页：点击工具栏"⏩ 自动翻页"按钮
- 默认每10秒翻一页
- 调整翻页速度：在设置中修改"自动翻页间隔"（范围：3-60秒）
- 适用场景：跑步机上阅读、做饭时阅读、躺着阅读不想动手

### 阅读统计

#### 查看统计数据
1. 点击工具栏"📊 统计"按钮
2. 侧边栏显示统计信息：
   - 今日阅读时长
   - 阅读进度百分比
   - 章节进度

## 💡 使用技巧

### 技巧1：快速定位
1. 使用章节跳转快速定位到大致位置
2. 使用翻页功能精确定位
3. 在关键位置添加书签方便回溯

### 技巧2：护眼设置
长时间阅读建议：
1. 选择护眼绿或羊皮纸主题
2. 行距设置为1.8-2.0
3. 字体大小18-20
4. 每30分钟休息5分钟

### 技巧3：提高阅读效率
1. 使用自动翻页解放双手
2. 沉浸模式减少干扰
3. 章节跳转快速浏览
4. 书签标记重要内容

### 技巧4：个性化配置
1. 创建自己的阅读主题
2. 调整最舒适的字体大小
3. 设置合适的行距和段距
4. 根据内容类型选择栏数

## ⚙️ 推荐设置

### 长时间阅读
```
主题: 护眼绿 / 羊皮纸
字体: 18px
行距: 1.8-2.0
段距: 10px
首行缩进: 开启
栏数: 1栏
```

### 快速浏览
```
主题: 日间模式
字体: 16px
行距: 1.5
段距: 6px
首行缩进: 关闭
栏数: 2-3栏
每页字数: 增加
```

### 夜间阅读
```
主题: 夜间模式
字体: 18-20px
行距: 2.0
窗口透明度: 80%
栏数: 1栏
```

### 专注模式
```
沉浸模式: 开启
自动翻页: 开启 (10秒)
计时器: 开启
窗口置顶: 开启
```

## 🔮 未来计划

### 短期优化 (v2.1)
- [ ] 自定义主题编辑器UI
- [ ] 阅读速度统计
- [ ] 每日阅读目标设置
- [ ] 书签分组管理

### 中期计划 (v2.2)
- [ ] 云端同步（WebDAV支持）
- [ ] 语音朗读（TTS）
- [ ] 笔记批注系统
- [ ] 阅读热力图

### 长期愿景 (v3.0)
- [ ] AI智能推荐
- [ ] 内容摘要
- [ ] 社区分享功能
- [ ] 跨平台支持（Web版、移动端）

## 📝 版本历史

### v2.0.0 (2025-10-15)
**新增**
- ✨ 极简/沉浸模式
- ✨ 多栏排版（1-3栏）
- ✨ 8种护眼主题
- ✨ 细化排版设置
- ✨ 自动翻页功能
- ✨ 智能章节识别
- ✨ 书签系统
- ✨ 专注计时器
- ✨ 阅读统计
- ✨ 自定义主题
- ✨ **全局热键系统**（任何界面快速启动）
- ✨ **热键冲突检测**（自动检测已占用的组合键）
- ✨ **热键自定义配置界面**（可视化配置所有快捷键）
- ✨ **开机自启动选项**（应用随系统启动）

**改进**
- 🔧 优化性能（章节识别速度提升50%）
- 🔧 改进UI/UX（新增大量快捷键）
- 🔧 增强稳定性（完善异常处理）
- 🔧 **热键管理**（支持启用/禁用单个热键）
- 🔧 **配置持久化**（所有设置自动保存）

**修复**
- 🐛 修复已知bug

### v1.0.0 (2025-10-01)
- 🎉 首次发布
- ✅ 基础阅读功能
- ✅ 书架管理
- ✅ 伪装模式

## 🐛 已知问题与限制

### 已知问题
1. **章节识别**：非标准格式可能不准确（建议：增加更多正则模式）
2. **多栏排版**：当前为简单列分割（建议：实现智能分页算法）
3. **自动翻页**：固定时间间隔（建议：根据内容长度动态调整）

### 技术限制
1. **大文件处理**：建议单文件 <10MB，超大文件影响性能
2. **内存占用**：多本书同时打开会增加内存（建议：实现书籍卸载机制）
3. **章节数量**：超过1000章可能影响列表性能（建议：实现虚拟化列表）

## 🆘 常见问题

**Q: 章节识别不准确？**  
A: 使用书签手动标记章节位置

**Q: 自动翻页太快/太慢？**  
A: 在设置中调整翻页间隔(3-60秒)

**Q: 如何备份数据？**  
A: 复制 %LocalAppData%\YuYue 文件夹

**Q: 快捷键不生效？**  
A: 检查是否与其他软件冲突

**Q: 如何重置设置？**  
A: 删除 preferences.json 文件

**Q: TXT文件出现乱码？**  
A: 用记事本打开文件，另存为 → 编码选择"UTF-8"，重新导入到鱼阅

## 📄 许可证

待定（建议使用 MIT 或 GPL-3.0）

## 🤝 贡献指南

欢迎贡献代码、书源规则、主题配色等！

### 问题反馈
- 发现bug？提交Issue
- 有建议？欢迎讨论
- 想贡献？Pull Request

## 📞 联系方式

待补充

---

**享受阅读，专注当下！** 📚✨